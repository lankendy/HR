<div class="search-water-quality-report">
  <nz-modal [(nzVisible)]="isVisible" nzTitle="{{ title | translate }}" [nzFooter]="modalFooter" [nzWidth]="1300"
    (nzOnCancel)="handleCancel()" (nzAfterOpen)="openModal()">
    <page-grid>
      <div nz-row>
        <div nz-col nzSpan="24">
          <nz-select class="input-search" [(ngModel)]="request.searchText" (ngModelChange)="nzOnSearch($event)"
            nzMode="tags" nzPlaceHolder="{{'components.modals.search-loai-cong-trinh.table.search' | translate}}">
          </nz-select>
        </div>
      </div>
      <div nz-row>
        <div nz-col nzSpan="24">
          <div nz-row>
            <div nz-col nzSpan="6">
              <nz-select class="select-search" nzPlaceHolder="{{ 'layout.search.group' | translate }}" nzAllowClear
                [ngModel]="groupBy" (ngModelChange)="nzOnSearchGroup($event)">
                <nz-option nzValue="code" nzLabel="{{'components.modals.search-loai-cong-trinh.table.code' | translate}}"> </nz-option>
              </nz-select>
            </div>
            <div nz-col nzSpan="18">
              <nz-pagination class="float-right mr-2" [(nzPageSize)]="request.pageSize"
                [(nzPageIndex)]="request.currentPage" (nzPageIndexChange)="nzPageIndexChange($event)"
                [nzShowTotal]="totalTemplate" [(nzTotal)]="total">
              </nz-pagination>
              <ng-template #totalTemplate let-total>
                {{ request.pageSize * (request.currentPage - 1) + 1 }}
                -{{
                  request.pageSize * request.currentPage > total ? total : request.pageSize * request.currentPage
                }}
                /{{ total }}
              </ng-template>
            </div>
          </div>
        </div>
      </div>
      <div nz-row>
        <nz-card class="w-100">
          <nz-table [nzLoading]="loading" #rowSelectionTable nzBordered [nzData]="dsLoaiCongTrinh"
            [nzFrontPagination]="false">
            <thead (nzSortChange)="nzSortChange($event)">
              <tr class="ant-header-customize">
                <th nzWidth="50px" nzShowExpand *ngIf="expandable"></th>
                <th *ngIf="expandable"></th>
                <th nzShowSort nzSortKey="code">{{'components.modals.search-loai-cong-trinh.table.code' | translate}}</th>
                <th nzShowSort nzSortKey="name">{{'components.modals.search-loai-cong-trinh.table.name' | translate}}</th>
              </tr>
            </thead>
            <tbody>
              <ng-template ngFor let-data [ngForOf]="rowSelectionTable.data">
                <tr [ngClass]="{ 'col-group': expandable }" (click)="!expandable && onSelectRow(data)">
                  <td *ngIf="expandable"></td>
                  <td nzShowExpand *ngIf="expandable" [(nzExpand)]="data.expand"></td>
                  <td *ngIf="expandable" [ngClass]="{ 'col-group-text': expandable }">
                    {{ data[groupBy] }}
                  </td>
                  <td>{{ expandable ? '' : data.maLoaiCongTrinh }}</td>
                  <td>{{ expandable ? '' : data.tenLoaiCongTrinh }}</td>
                </tr>
                <tr [nzExpand]="data.expand" *ngFor="let item of data.children" (click)="onSelectRow(item)">
                  <td></td>
                  <td></td>
                  <td>{{ item.maLoaiCongTrinh }}</td>
                  <td>{{ item.tenLoaiCongTrinh }}</td>
                </tr>
              </ng-template>
            </tbody>
          </nz-table>
        </nz-card>
      </div>
      <ng-template #modalFooter>
        <button nz-button nzType="default" (click)="handleCancel()">{{ 'layout.btn.cancel' | translate }}</button>
      </ng-template>
    </page-grid>
  </nz-modal>
</div>
